# HSC JIT v3.6 - Static Build System

## ğŸ¯ What Changed?

**v3.5 â†’ v3.6 Architecture Shift:**

- âŒ Removed: FastAPI runtime, Redis, Celery, WebSockets
- âœ… Added: Offline build pipeline, static JSON output
- ğŸš€ Result: Zero infrastructure, instant performance

## ğŸ“ New File Structure

```
backend/
  build.py              # Master build script (run this!)
  core/
    cleaner.py          # Data quality & deduplication
    matcher.py          # Halilit fuzzy matching

frontend/
  public/
    data/
      index.json        # Master searchable index
      {brand}.json      # Per-brand catalogs
    manuals/            # Downloaded PDFs (future)
```

## ğŸš€ Quick Start

### Build Everything

```bash
cd backend
python build.py --brand=all
```

### Build Single Brand

```bash
python build.py --brand=nord --validate
```

### List Available Brands

```bash
python build.py --list
```

## ğŸ“Š Current Status (Jan 16, 2026)

### Build Results

- **Total Products**: 2,026 across 38 brands
- **Build Time**: ~15 seconds for all brands
- **Output Size**: ~1.5MB static JSON

### Top Brands by Product Count

1. Pearl: 364 products
2. M-Audio: 312 products
3. Roland: 229 products
4. Remo: 224 products
5. Mackie: 219 products
6. Boss: 197 products
7. Paiste Cymbals: 151 products

### Data Quality Highlights

- âœ… **Nord**: 13 products, 84.62% Halilit match rate
- âœ… **Adam Audio**: 25 products, 100% match rate
- âœ… **M-Audio**: 312 products, 8.3% match rate
- âš ï¸ **Roland**: 229 products, 0% match (needs Halilit catalog)

## ğŸ”§ How It Works

### Step 1: Data Cleaning

```python
# Removes duplicates by (name + image_url)
# Validates required fields: name, brand
# Normalizes categories
```

### Step 2: Halilit Matching

```python
# Fuzzy name matching (85% threshold)
# Adds: verified=true, halilit_sku, match_quality
# Confidence scoring: "excellent" vs "good"
```

### Step 3: JSON Generation

```python
# Per-brand: frontend/public/data/{brand}.json
# Master index: frontend/public/data/index.json
# Stats: total, verified, match rate
```

## ğŸ“ˆ Next Steps (Week 2)

### Priority 1: Fix Missing Halilit Catalogs

Many brands show 0% match because their Halilit catalogs are empty:

```bash
# Check which brands need Halilit data
cd backend/data/catalogs_halilit
for f in *.json; do
  count=$(jq '.products | length' "$f")
  if [ "$count" -eq 0 ]; then
    echo "Empty: $f"
  fi
done
```

### Priority 2: PDF Manual Hunter

Create `backend/core/pdf_hunter.py`:

```python
# Search: site:{brand.domain} filetype:pdf {model}
# Download to: frontend/public/manuals/{brand}/
# Mark: has_manual=true in catalog
```

### Priority 3: Frontend Integration

Update `frontend/src/` to load static JSON:

```typescript
// Replace API calls with:
const catalog = await fetch('/data/index.json')
const fuse = new Fuse(catalog.products, {...})
```

### Priority 4: Automated Nightly Builds

Create `.github/workflows/nightly-build.yml`:

```yaml
# Runs: python build.py --brand=all
# Commits: updated JSON files
# Deploys: to Netlify automatically
```

## ğŸ¯ Success Metrics

### Target (v3.6 Complete)

- [ ] 80%+ Halilit match rate across all brands
- [ ] 60%+ products with local PDF manuals
- [ ] <50ms frontend search (in-memory)
- [ ] Zero runtime infrastructure cost
- [ ] Nightly automated builds

### Current (v3.6 Alpha)

- [x] Build pipeline working
- [x] Data cleaning & deduplication
- [x] Fuzzy Halilit matching (85% threshold)
- [x] Static JSON generation
- [x] 38 brands with 2,026 products
- [ ] PDF manual downloads
- [ ] Frontend integration
- [ ] Automated deploys

## ğŸ” Verification

### Check Output Quality

```bash
# View index
cat frontend/public/data/index.json | jq '.total_products, .total_verified'

# Check specific brand
cat frontend/public/data/nord.json | jq '.stats'

# See matched products
cat frontend/public/data/nord.json | jq '.products[] | select(.verified) | {name, match_quality}'
```

### Run Quality Report

```bash
python -c "
from core.cleaner import DataCleaner
import json

cleaner = DataCleaner()
data = json.load(open('data/catalogs_brand/nord_brand.json'))
report = cleaner.get_quality_report(data['products'])
print(json.dumps(report, indent=2))
"
```

## ğŸ“ Developer Notes

### Adding New Brands

1. Scrape brand website â†’ `data/catalogs_brand/{brand}_brand.json`
2. Get Halilit catalog â†’ `data/catalogs_halilit/{brand}_halilit.json`
3. Run build: `python build.py --brand={brand}`
4. Check match rate in output stats

### Improving Match Rate

- Ensure Halilit catalog exists for brand
- Check product name consistency
- Review `core/matcher.py` normalization logic
- Lower threshold temporarily for testing

### Debugging Failed Builds

```bash
# Enable debug logging
export LOG_LEVEL=DEBUG
python build.py --brand=nord --validate

# Check data quality
python -c "
from core.cleaner import DataCleaner
import json

data = json.load(open('data/catalogs_brand/nord_brand.json'))
cleaner = DataCleaner()
for p in data['products']:
    if not cleaner.validate_required_fields(p):
        print(f'Invalid: {p}')
"
```

## ğŸ‰ Quick Wins Completed

âœ… **Nord Duplicates**: Already clean (13 unique products)  
âœ… **Roland Scraper**: 592 products loaded successfully  
âœ… **Build Pipeline**: Fully functional static builder  
âœ… **Data Quality**: Deduplication + validation working  
âœ… **Fuzzy Matching**: 84.62% success rate on Nord

## ğŸš€ Deploy Preview

Once frontend is updated, deploy will be:

```bash
# Build static catalog
cd backend && python build.py --brand=all

# Build frontend
cd ../frontend && pnpm build

# Deploy (Netlify/Vercel)
netlify deploy --dir=dist --prod
```

**Result**: Static site, instant search, zero backend! ğŸ¯
